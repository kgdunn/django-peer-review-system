{% load template_extras %}

<h2 style="display:inline; clear:none;">Learner overview</h2><br>


<style>

.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

.node circle {
  fill: #ccc;
  stroke: #fff;
  stroke-width: 1.5px;
}

text {
  font: 10px sans-serif;
  pointer-events: none;
}

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var links = [
    {"weight": 1, "target": 28, "source": 0}, {"weight": 1, "target": 54, "source": 0}, {"weight": 1, "target": 30, "source": 1}, {"weight": 1, "target": 51, "source": 1}, {"weight": 1, "target": 29, "source": 2}, {"weight": 1, "target": 52, "source": 2}, {"weight": 1, "target": 51, "source": 3}, {"weight": 1, "target": 45, "source": 3}, {"weight": 1, "target": 1, "source": 4}, {"weight": 1, "target": 50, "source": 4}, {"weight": 1, "target": 23, "source": 5}, {"weight": 1, "target": 15, "source": 5}, {"weight": 1, "target": 21, "source": 6}, {"weight": 1, "target": 8, "source": 7}, {"weight": 1, "target": 10, "source": 8}, {"weight": 1, "target": 20, "source": 8}, {"weight": 1, "target": 21, "source": 9}, {"weight": 1, "target": 14, "source": 9}, {"weight": 1, "target": 9, "source": 10}, {"weight": 1, "target": 11, "source": 10}, {"weight": 1, "target": 15, "source": 11}, {"weight": 1, "target": 22, "source": 11}, {"weight": 1, "target": 9, "source": 12}, {"weight": 1, "target": 18, "source": 12}, {"weight": 1, "target": 7, "source": 13}, {"weight": 1, "target": 25, "source": 13}, {"weight": 1, "target": 19, "source": 14}, {"weight": 1, "target": 12, "source": 14}, {"weight": 1, "target": 26, "source": 15}, {"weight": 1, "target": 22, "source": 15}, {"weight": 1, "target": 24, "source": 16}, {"weight": 1, "target": 13, "source": 16}, {"weight": 1, "target": 16, "source": 17}, {"weight": 1, "target": 25, "source": 17}, {"weight": 1, "target": 27, "source": 18}, {"weight": 1, "target": 11, "source": 18}, {"weight": 1, "target": 10, "source": 19}, {"weight": 1, "target": 6, "source": 19}, {"weight": 1, "target": 18, "source": 20}, {"weight": 1, "target": 14, "source": 20}, {"weight": 1, "target": 8, "source": 21}, {"weight": 1, "target": 26, "source": 21}, {"weight": 1, "target": 7, "source": 23}, {"weight": 1, "target": 27, "source": 23}, {"weight": 1, "target": 12, "source": 24}, {"weight": 1, "target": 6, "source": 24}, {"weight": 1, "target": 16, "source": 25}, {"weight": 1, "target": 19, "source": 25}, {"weight": 1, "target": 20, "source": 26}, {"weight": 1, "target": 23, "source": 27}, {"weight": 1, "target": 24, "source": 27}, {"weight": 1, "target": 32, "source": 28}, {"weight": 1, "target": 46, "source": 28}, {"weight": 1, "target": 0, "source": 29}, {"weight": 1, "target": 32, "source": 29}, {"weight": 1, "target": 50, "source": 30}, {"weight": 1, "target": 44, "source": 30}, {"weight": 1, "target": 42, "source": 31}, {"weight": 1, "target": 35, "source": 31}, {"weight": 1, "target": 2, "source": 32}, {"weight": 1, "target": 43, "source": 33}, {"weight": 1, "target": 36, "source": 33}, {"weight": 1, "target": 42, "source": 34}, {"weight": 1, "target": 31, "source": 34}, {"weight": 1, "target": 40, "source": 36}, {"weight": 1, "target": 36, "source": 37}, {"weight": 1, "target": 33, "source": 37}, {"weight": 1, "target": 31, "source": 39}, {"weight": 1, "target": 35, "source": 40}, {"weight": 1, "target": 40, "source": 41}, {"weight": 1, "target": 43, "source": 42}, {"weight": 1, "target": 37, "source": 42}, {"weight": 1, "target": 37, "source": 43}, {"weight": 1, "target": 33, "source": 43}, {"weight": 1, "target": 1, "source": 44}, {"weight": 1, "target": 52, "source": 44}, {"weight": 1, "target": 46, "source": 45}, {"weight": 1, "target": 54, "source": 45}, {"weight": 1, "target": 49, "source": 46}, {"weight": 1, "target": 47, "source": 46}, {"weight": 1, "target": 0, "source": 47}, {"weight": 1, "target": 48, "source": 47}, {"weight": 1, "target": 53, "source": 48}, {"weight": 1, "target": 4, "source": 48}, {"weight": 1, "target": 29, "source": 49}, {"weight": 1, "target": 3, "source": 49}, {"weight": 1, "target": 45, "source": 50}, {"weight": 1, "target": 3, "source": 50}, {"weight": 1, "target": 47, "source": 51}, {"weight": 1, "target": 48, "source": 51}, {"weight": 1, "target": 30, "source": 52}, {"weight": 1, "target": 44, "source": 52}, {"weight": 1, "target": 28, "source": 53}, {"weight": 1, "target": 49, "source": 53}, {"weight": 1, "target": 53, "source": 54}, {"weight": 1, "target": 4, "source": 54}
];

var nodes = {};

// Compute the distinct nodes from the links.
links.forEach(function(link) {
  link.source = nodes[link.source] || (nodes[link.source] = {name: link.source});
  link.target = nodes[link.target] || (nodes[link.target] = {name: link.target});
});

var width = 900, height = 400;
var circle_radius = 8;
var linkDistance = 2;
var linkStrength = 0.5;
var charge = -250;

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(linkDistance)
    .linkStrength(linkStrength)
    .charge(charge)
    .friction(0.9)
    .gravity(0.1)
    .theta(0.8)
    .alpha(0.5)
    .on("tick", tick)
    .start();


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var link = svg.selectAll(".link")
    .data(force.links())
  .enter().append("line")
    .attr("class", "link");

var node = svg.selectAll(".node")
    .data(force.nodes())
  .enter().append("g")
    .attr("class", "node")
    .on("mouseover", mouseover)
    .on("mouseout", mouseout)
    .call(force.drag);

node.append("circle")
    .attr("r", circle_radius);

node.append("text")
    .attr("x", -circle_radius/2)
    .attr("dy", ".35em")
    .text(function(d) { return d.name; });

function tick() {
  link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  node
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
}

function mouseover() {
  d3.select(this).select("circle").transition()
      .duration(750)
      .attr("r", circle_radius*2);
}

function mouseout() {
  d3.select(this).select("circle").transition()
      .duration(750)
      .attr("r", circle_radius);
}

</script>






<script>
$(document).ready( function () {

  $('#class_overview').DataTable( {
    paging: false,
    order: [[ 6, "asc" ], [ 5, "asc" ], [ 4, "asc" ], [ 3, "asc" ], [ 2, "asc" ]],
    searching: true,
    fixedHeader: {
        header: true,
        footer: true
    },
    bInfo: false,
    bAutoWidth: false,
  } );
} );
</script>


{% if global_summary_link %}
<a style="float: right" href="{{global_summary_link}}">Links to all deliverables</a>
{% endif %}

<table class="summaries pr-admin" id="class_overview">
<thead>
<tr>
  <th>Initials</th>
  <th>Learner</th>
  <th>Submit</th>
  <th>Review (x2)</th>
  <th>Evaluate</th>
  <th>Rebut</th>
  <th>Assess</th>
  <th>Reviewer of</th>
  <th>Reviewed by</th>
</tr>

</thead>
<tbody>
{% for learner in learners %}
<tr>
  <td>{{learner.get_initials}}</td>
  <td>{{learner.show_group}} {{learner.display_name}}<br>
    <span style="color:#999">{{learner.email|slice:"@student.tudelft.nl"}}</span>
  </td>
    {% with report=reports|keyvalue:learner %}
      {% for key in report.keys %}
        {% with item=report|keyvalue:key%}
          <td data-order="{{item.when.timestamp}}">
            {% if item.when %}
                {% if item.hyperlink %}
                  <a target="_blank" href="{{item.hyperlink}}">{{item.when|date:"d M"}},{{item.when|date:"H:i"}}</a>
                {% else %}
                  {{item.when|date:"d M"}},{{item.when|date:"H:i"}}
                {% endif %}
            {% else %}
                {% if item %}
                  {{item|safe}}
                {%endif%}
            {%endif%}
          </td>
        {% endwith %}
      {% endfor %} {#  keys in ``report`` #}
    {% endwith %}



</tr>
{% endfor %}
</tbody></table>
